<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- RWD é—œéµï¼šåŠ å…¥ viewport meta æ¨™ç±¤ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥é–“éƒ¨å­¸ç”Ÿ - AI æŸ¥è©¢ (èªéŸ³æ–‡å­—é€šç”¨ç‰ˆ)</title>
    <!-- æ¨£å¼éƒ¨åˆ† -->
    <style>
        body { font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; line-height: 1.6; margin: 0; padding: 0; background-color: #f4f4f4; }
        .wrap { max-width: 1200px; margin: 0 auto; background-color: #fff; padding: 20px; box-sizing: border-box; }
        .main.container { padding: 0 15px; }
        .listBS { display: flex; flex-wrap: wrap; gap: 20px; justify-content: flex-start; margin-bottom: 20px; }
        .d-item { width: calc(25% - 15px); box-sizing: border-box; border: 2px solid #ddd; border-radius: 8px; overflow: hidden; text-align: center; display: flex; flex-direction: column; }
        .d-img { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        .d-item img { width: 100%; height: auto; object-fit: cover; }
        .d-txt { padding: 15px; background-color: #fafafa; }
        .d-txt a { text-decoration: none; color: #333; font-weight: bold; }
        .ai-query-container { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; padding: 25px; margin: 30px auto; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08); max-width: 1140px; }
        .ai-query-container h3 { margin-top: 0; font-size: 24px; color: #343a40; }
        .ai-query-input-group { display: flex; gap: 10px; margin-top: 15px; }
        #ai-question-input { flex-grow: 1; padding: 12px 15px; font-size: 16px; border: 1px solid #ced4da; border-radius: 8px; min-width: 0; }
        #ai-query-btn { padding: 12px 25px; font-size: 16px; font-weight: bold; color: #fff; background-color: #007bff; border: none; border-radius: 8px; cursor: pointer; flex-shrink: 0; }
        #ai-query-btn:disabled { background-color: #6c757d; cursor: not-allowed; }
        #ai-query-status { margin-top: 15px; color: #6c757d; font-size: 14px; min-height: 21px; word-break: break-word; }
        #ai-query-status .found-item { color: #28a745; font-weight: bold; }
        .ai-highlight { transition: all 0.3s ease-in-out; border: 4px solid #dc3545 !important; transform: scale(1.02); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15); z-index: 10; position: relative; }

        /* éº¥å…‹é¢¨æŒ‰éˆ•çš„æ¨£å¼ */
        #mic-btn {
            padding: 0 15px;
            font-size: 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }
        #mic-btn:hover { background-color: #5a6268; }
        #mic-btn.is-recording { background-color: #dc3545; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        /* --- RWD åª’é«”æŸ¥è©¢ --- */

        /* å¹³æ¿å°ºå¯¸ (è¢å¹•å¯¬åº¦å°æ–¼ç­‰æ–¼ 992px) */
        @media (max-width: 992px) {
            .d-item { width: calc(50% - 10px); }
            .wrap { padding: 15px; }
        }

        /* æ‰‹æ©Ÿå°ºå¯¸ (è¢å¹•å¯¬åº¦å°æ–¼ç­‰æ–¼ 576px) */
        @media (max-width: 576px) {
            .d-item { width: 100%; }
            .wrap { padding: 10px; }
            .ai-query-container { padding: 15px; margin: 20px auto; }
            .ai-query-container h3 { font-size: 20px; }
            /* å°‡è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•çµ„å‚ç›´æ’åˆ—ï¼Œä¸¦èª¿æ•´é †åºå’Œæ¨£å¼ */
            .ai-query-input-group {
                flex-direction: column;
            }
            #ai-question-input {
                order: 1; /* è®“è¼¸å…¥æ¡†åœ¨æœ€ä¸Šé¢ */
            }
            .button-group {
                display: flex;
                gap: 10px;
                order: 2; /* è®“æŒ‰éˆ•çµ„åœ¨ä¸‹é¢ */
            }
            #mic-btn {
                flex-grow: 1; /* è®“éº¥å…‹é¢¨æŒ‰éˆ•è®Šå¤§ï¼Œæ›´å®¹æ˜“é»æ“Š */
                padding: 12px;
            }
            #ai-query-btn {
                flex-grow: 2; /* è®“æŸ¥è©¢æŒ‰éˆ•ä½”æ›´å¤§ç©ºé–“ */
            }
            .d-txt a { font-size: 15px; }
        }
    </style>
</head>

<body>
<div class="wrap">
    <!-- AI æŸ¥è©¢ä»‹é¢ (å·²ä¿®æ”¹HTMLçµæ§‹ä»¥é©æ‡‰RWD) -->
    <div class="ai-query-container">
        <h3>AI æ™ºæ…§æŸ¥è©¢-èªéŸ³æ–‡å­—é€šç”¨ç‰ˆ</h3>
        <p>æœ‰ä»€éº¼å•é¡Œå—ï¼Ÿç›´æ¥ç”¨èªªçš„ï¼Œæˆ‘å¹«æ‚¨æ‰¾å‡ºç›¸é—œè³‡è¨Šï¼ (åˆ‡æ›ç‚º<a href="/">ç´”æ–‡å­—ç‰ˆ</a>)</p>
        <div class="ai-query-input-group">
            <input type="text" id="ai-question-input" placeholder="ä¾‹å¦‚ï¼šå®¿èˆå¦‚ä½•ç”³è«‹ï¼Ÿæˆ–é»æ“Šéº¥å…‹é¢¨èªªè©±">
            <!-- å°‡å…©å€‹æŒ‰éˆ•åŒ…åœ¨ä¸€å€‹ç¾¤çµ„è£¡ï¼Œæ–¹ä¾¿æ‰‹æ©Ÿç‰ˆæ’ç‰ˆ -->
            <div class="button-group">
                <button id="mic-btn" title="èªéŸ³è¼¸å…¥">ğŸ¤</button>
                <button id="ai-query-btn">æŸ¥è©¢</button>
            </div>
        </div>
        <div id="ai-query-status"></div>
    </div>

    <!-- æ¨¡æ“¬çš„ä¸»è¦å…§å®¹å€ -->
    <div class="main container" id="local-content-wrapper">
        <div class="module-rcglist">
            <div class="row listBS">
                <!-- åŒ…å«å…¨éƒ¨21å€‹é …ç›® (HTMLçµæ§‹ä¸è®Š) -->
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="1-è¨»å†Šé ˆçŸ¥(å«å¤§ä¸€è‹±æ–‡åˆ†ç­è³‡è¨Š)"><img src="/static/img/adam-kool-ndN00KmbJ1c-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="1-è¨»å†Šé ˆçŸ¥(å«å¤§ä¸€è‹±æ–‡åˆ†ç­è³‡è¨Š)">1-è¨»å†Šé ˆçŸ¥(å«å¤§ä¸€è‹±æ–‡åˆ†ç­è³‡è¨Š)</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="2-è¦ªå¸«åº§è«‡æœƒ"><img src="/static/img/aedrian-salazar-Tws17PwytpA-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="2-è¦ªå¸«åº§è«‡æœƒ">2-è¦ªå¸«åº§è«‡æœƒ</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="3-æ–°ç”Ÿå…¥å­¸è¼”å°"><img src="/static/img/amirali-mirhashemian-cRNUvWM9l_I-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="3-æ–°ç”Ÿå…¥å­¸è¼”å°">3-æ–°ç”Ÿå…¥å­¸è¼”å°</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="4-æ–°ç”Ÿé«”æª¢"><img src="/static/img/asya-morgunova-ki2Moh6jiCc-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="4-æ–°ç”Ÿé«”æª¢">4-æ–°ç”Ÿé«”æª¢</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="5-å­¸ç”Ÿå®¿èˆ(æ–°ç”Ÿå…¥ä½é ˆçŸ¥)"><img src="/static/img/hoyoun-lee-_EfvzmlxcVA-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="5-å­¸ç”Ÿå®¿èˆ(æ–°ç”Ÿå…¥ä½é ˆçŸ¥)">5-å­¸ç”Ÿå®¿èˆ(æ–°ç”Ÿå…¥ä½é ˆçŸ¥)</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="6-æ ¡å¤–ç§Ÿå±‹"><img src="/static/img/clay-banks-31l-8hY1mt4-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="6-æ ¡å¤–ç§Ÿå±‹">6-æ ¡å¤–ç§Ÿå±‹</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="7-å…µå½¹è³‡è¨Š"><img src="/static/img/henry-be-IicyiaPYGGI-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="7-å…µå½¹è³‡è¨Š">7-å…µå½¹è³‡è¨Š</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="8-æ–°ç”Ÿèª²å‹™"><img src="/static/img/hoyoun-lee-bY2Kys3q1C0-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="8-æ–°ç”Ÿèª²å‹™">8-æ–°ç”Ÿèª²å‹™</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="9-å­¸é›œè²»æ¸›å…"><img src="/static/img/hoyoun-lee-FHKuhp38f_A-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="9-å­¸é›œè²»æ¸›å…">9-å­¸é›œè²»æ¸›å…</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="10-å°±å­¸è²¸æ¬¾"><img src="/static/img/hoyoun-lee-GDLbUSmrmoU-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="10-å°±å­¸è²¸æ¬¾">10-å°±å­¸è²¸æ¬¾</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="11-çåŠ©å­¸é‡‘è³‡è¨Š"><img src="/static/img/hoyoun-lee-lvs2w15Yw4M-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="11-çåŠ©å­¸é‡‘è³‡è¨Š">11-çåŠ©å­¸é‡‘è³‡è¨Š</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="12-å¼±å‹¢åŠ©å­¸è¨ˆç•«"><img src="/static/img/hoyoun-lee-oq7ELhpPkz4-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="12-å¼±å‹¢åŠ©å­¸è¨ˆç•«">12-å¼±å‹¢åŠ©å­¸è¨ˆç•«</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="13-æ ¡å…§å·¥è®€"><img src="/static/img/hoyoun-lee-yYxiTfjeJ20-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="13-æ ¡å…§å·¥è®€">13-æ ¡å…§å·¥è®€</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="14-è³‡è¨Šç³»çµ±å­¸ç”Ÿç¯‡"><img src="/static/img/husna-miskandar-FC4z3l4sUYc-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="14-è³‡è¨Šç³»çµ±å­¸ç”Ÿç¯‡">14-è³‡è¨Šç³»çµ±å­¸ç”Ÿç¯‡</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="15-å­¸ç”Ÿç¶œåˆè³‡æ–™"><img src="/static/img/nik-sYVY_ZKwaxU-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="15-å­¸ç”Ÿç¶œåˆè³‡æ–™">15-å­¸ç”Ÿç¶œåˆè³‡æ–™</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="16-ç¬¬eå­¸é›œè²»å…¥å£ç¶²"><img src="/static/img/pao-dayag-AwCPMLL-fPc-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="16-ç¬¬eå­¸é›œè²»å…¥å£ç¶²">16-ç¬¬eå­¸é›œè²»å…¥å£ç¶²</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="17-äº¤é€šè³‡è¨Š"><img src="/static/img/vidar-nordli-mathisen-2cNh00feVzw-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="17-äº¤é€šè³‡è¨Š">17-äº¤é€šè³‡è¨Š</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="18-æ ¡åœ’åœ°åœ–"><img src="/static/img/robert-lukeman-_RBcxo9AU-U-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="18-æ ¡åœ’åœ°åœ–">18-æ ¡åœ’åœ°åœ–</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="19-è¡Œäº‹æ›†"><img src="/static/img/sam-schooler-E9aetBe2w40-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="19-è¡Œäº‹æ›†">19-è¡Œäº‹æ›†</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="20-å­¸ç”Ÿæ‰‹å†Š"><img src="/static/img/urban-vintage-78A265wPiO4-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="20-å­¸ç”Ÿæ‰‹å†Š">20-å­¸ç”Ÿæ‰‹å†Š</a></div></div></div>
                <div class="d-item"><div class="mbox"><div class="d-img"><a href="#" title="21-3+1å°±å­¸å½¹ç”·"><img src="/static/img/qingbao-meng-01_igFr7hd4-unsplash.jpg" alt="ImgDesc" /></a></div><div class="d-txt"><a href="#" title="21-3+1å°±å­¸å½¹ç”·">21-3+1å°±å­¸å½¹ç”·</a></div></div></div>
            </div>
        </div>
    </div>
</div>

<script>
        /**
         * AI æ™ºæ…§æŸ¥è©¢ç³»çµ± - JavaScript ä¸»ç¨‹å¼ (èªéŸ³æ–‡å­—é€šç”¨ç‰ˆ)
         * åŠŸèƒ½èªªæ˜ï¼š
         * 1. æ”¶é›†é é¢ä¸­çš„æ‰€æœ‰è³‡æ–™é …ç›®ï¼ˆå¾ title å±¬æ€§ç²å–é—œéµå­—ï¼‰
         * 2. æ¥æ”¶ä½¿ç”¨è€…è¼¸å…¥çš„å•é¡Œï¼ˆæ”¯æ´æ–‡å­—è¼¸å…¥å’ŒèªéŸ³è¼¸å…¥ï¼‰
         * 3. æ•´åˆ Web Speech API æä¾›èªéŸ³è­˜åˆ¥åŠŸèƒ½
         * 4. å°‡å•é¡Œå’Œé—œéµå­—ç™¼é€åˆ°å¾Œç«¯ AI API é€²è¡Œåˆ†æ
         * 5. æ ¹æ“š AI å›å‚³çš„çµæœé«˜äº®é¡¯ç¤ºç›¸é—œé …ç›®
         * 6. æä¾›å®Œæ•´çš„è¦–è¦ºå›é¥‹ã€èªéŸ³ç‹€æ…‹ç®¡ç†å’ŒéŒ¯èª¤è™•ç†
         */

        // --- ç­‰å¾… DOM å®Œå…¨è¼‰å…¥å¾ŒåŸ·è¡Œä¸»ç¨‹å¼ ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log('åˆå§‹åŒ– AI èªéŸ³æŸ¥è©¢ç³»çµ±...');

            // --- å…¨åŸŸè®Šæ•¸å®šç¾© ---

            // DOM å…ƒç´ å¼•ç”¨ï¼šè¼¸å…¥æ¡†ã€æŒ‰éˆ•ã€ç‹€æ…‹é¡¯ç¤ºå€åŸŸ
            const questionInput = document.getElementById('ai-question-input');  // ä½¿ç”¨è€…å•é¡Œè¼¸å…¥æ¡†
            const queryBtn = document.getElementById('ai-query-btn');            // æŸ¥è©¢æŒ‰éˆ•
            const statusDiv = document.getElementById('ai-query-status');        // æŸ¥è©¢ç‹€æ…‹é¡¯ç¤ºå€åŸŸ
            const micBtn = document.getElementById('mic-btn');                   // éº¥å…‹é¢¨èªéŸ³è¼¸å…¥æŒ‰éˆ•

            // API ç«¯é»è¨­å®š
            const backendApiUrl = '/api/ai-query';  // å¾Œç«¯ AI æŸ¥è©¢ API è·¯å¾‘

            // é é¢è³‡æ–™å„²å­˜é™£åˆ—ï¼šå­˜æ”¾æ‰€æœ‰å¯æŸ¥è©¢çš„é …ç›®è³‡è¨Š
            let linkData = [];  // æ ¼å¼ï¼š[{keyword: "é …ç›®åç¨±", element: DOMå…ƒç´ }, ...]

            // --- æ ¸å¿ƒå‡½å¼å®šç¾© ---

            /**
             * æ›´æ–°é é¢é€£çµè³‡æ–™
             * åŠŸèƒ½ï¼šæƒæé é¢ä¸­æ‰€æœ‰çš„ .d-item å…ƒç´ ï¼Œæå–å…¶ä¸­çš„é—œéµå­—å’Œå°æ‡‰çš„ DOM å…ƒç´ 
             * é€™å€‹å‡½å¼æœƒåœ¨é é¢è¼‰å…¥æ™‚åŸ·è¡Œï¼Œå»ºç«‹å¯æŸ¥è©¢é …ç›®çš„è³‡æ–™åº«
             */
            function updateLinkData() {
                console.log('é–‹å§‹æ›´æ–°é é¢é€£çµè³‡æ–™...');

                // æ¸…ç©ºèˆŠè³‡æ–™ï¼Œæº–å‚™é‡æ–°æ”¶é›†
                const newLinkData = [];

                // æ‰¾åˆ°ä¸»è¦å…§å®¹å€åŸŸï¼Œå¦‚æœæ‰¾ä¸åˆ°å‰‡ä½¿ç”¨æ•´å€‹ body
                const contentArea = document.getElementById('local-content-wrapper') || document.body;

                // æ‰¾åˆ°æ‰€æœ‰å…·æœ‰ .d-item é¡åˆ¥çš„é …ç›®å…ƒç´ 
                const linkItems = contentArea.querySelectorAll('.d-item');

                // ä½¿ç”¨ Set ä¾†é¿å…é‡è¤‡çš„é—œéµå­—
                const keywordSet = new Set();

                // éæ­·æ¯å€‹é …ç›®å…ƒç´ 
                linkItems.forEach((item, index) => {
                    // åœ¨æ¯å€‹é …ç›®ä¸­æ‰¾åˆ° <a> æ¨™ç±¤
                    const anchor = item.querySelector('a');

                    // å¾ <a> æ¨™ç±¤çš„ title å±¬æ€§ç²å–é—œéµå­—ï¼Œä¸¦å»é™¤å‰å¾Œç©ºç™½
                    const keyword = anchor?.getAttribute('title')?.trim();

                    // å¦‚æœé—œéµå­—å­˜åœ¨ä¸”å°šæœªæ”¶é›†éï¼Œå‰‡åŠ å…¥è³‡æ–™é™£åˆ—
                    if (keyword && !keywordSet.has(keyword)) {
                        keywordSet.add(keyword);  // è¨˜éŒ„å·²è™•ç†çš„é—œéµå­—
                        newLinkData.push({
                            keyword: keyword,    // é …ç›®çš„é—œéµå­—ï¼ˆç”¨æ–¼ AI æ¯”å°ï¼‰
                            element: item       // å°æ‡‰çš„ DOM å…ƒç´ ï¼ˆç”¨æ–¼é«˜äº®é¡¯ç¤ºï¼‰
                        });
                        console.log(`æ”¶é›†åˆ°é …ç›® ${index + 1}: ${keyword}`);
                    }
                });

                // æ›´æ–°å…¨åŸŸè®Šæ•¸
                linkData = newLinkData;
                console.log(`ç¸½å…±æ”¶é›†åˆ° ${linkData.length} å€‹é …ç›®`);
            }

            /**
             * åŸ·è¡Œ AI æŸ¥è©¢çš„ä¸»è¦å‡½å¼
             * åŠŸèƒ½ï¼š
             * 1. é©—è­‰ä½¿ç”¨è€…è¼¸å…¥
             * 2. æ›´æ–° UI ç‹€æ…‹ï¼ˆåœç”¨æŒ‰éˆ•ã€é¡¯ç¤ºè¼‰å…¥è¨Šæ¯ï¼‰
             * 3. ç™¼é€è«‹æ±‚åˆ°å¾Œç«¯ AI API
             * 4. è™•ç†å›æ‡‰çµæœä¸¦æ›´æ–° UI
             * 5. éŒ¯èª¤è™•ç†å’Œç‹€æ…‹æ¢å¾©
             * æ³¨æ„ï¼šèªéŸ³ç‰ˆæœ¬éœ€è¦åŒæ™‚ç®¡ç†æŸ¥è©¢æŒ‰éˆ•å’Œéº¥å…‹é¢¨æŒ‰éˆ•çš„ç‹€æ…‹
             */
            async function performQuery() {
                console.log('é–‹å§‹åŸ·è¡Œ AI æŸ¥è©¢...');

                // æ­¥é©Ÿ 1: å–å¾—ä½¿ç”¨è€…è¼¸å…¥ä¸¦é©—è­‰
                const question = questionInput.value.trim();
                if (!question) {
                    statusDiv.textContent = 'è«‹å…ˆè¼¸å…¥æ‚¨çš„å•é¡Œã€‚';
                    console.warn('ä½¿ç”¨è€…æœªè¼¸å…¥å•é¡Œ');
                    return;
                }
                console.log(`ä½¿ç”¨è€…å•é¡Œ: ${question}`);

                // æ­¥é©Ÿ 2: æ›´æ–° UI ç‹€æ…‹ - é€²å…¥è¼‰å…¥ç‹€æ…‹
                queryBtn.disabled = true;                    // åœç”¨æŸ¥è©¢æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
                micBtn.disabled = true;                      // åœç”¨éº¥å…‹é¢¨æŒ‰éˆ•é˜²æ­¢æŸ¥è©¢ä¸­ä½¿ç”¨èªéŸ³
                queryBtn.textContent = 'æŸ¥è©¢ä¸­...';          // æ›´æ”¹æŒ‰éˆ•æ–‡å­—æç¤º
                clearHighlights();                           // æ¸…é™¤ä¹‹å‰çš„é«˜äº®çµæœ
                statusDiv.innerHTML = 'æ­£åœ¨å‘¼å« AI æ¨¡å‹ç‚ºæ‚¨åˆ†æï¼Œè«‹ç¨å€™...';  // é¡¯ç¤ºè¼‰å…¥è¨Šæ¯

                // æ­¥é©Ÿ 3: æº–å‚™ç™¼é€çµ¦ AI çš„è³‡æ–™
                const keywords = linkData.map(item => item.keyword);  // æå–æ‰€æœ‰é—œéµå­—
                console.log(`æº–å‚™ç™¼é€ ${keywords.length} å€‹é—œéµå­—åˆ° AI æ¨¡å‹`);

                try {
                    // æ­¥é©Ÿ 4: ç™¼é€ HTTP POST è«‹æ±‚åˆ°å¾Œç«¯ AI API
                    console.log('æ­£åœ¨ç™¼é€è«‹æ±‚åˆ°å¾Œç«¯ API...');
                    const response = await fetch(backendApiUrl, {
                        method: 'POST',                              // ä½¿ç”¨ POST æ–¹æ³•
                        headers: { 'Content-Type': 'application/json' },  // è¨­å®šè«‹æ±‚æ¨™é ­
                        body: JSON.stringify({
                            question: question,    // ä½¿ç”¨è€…çš„å•é¡Œ
                            keywords: keywords     // æ‰€æœ‰å¯æŸ¥è©¢çš„é …ç›®é—œéµå­—
                        })
                    });

                    // æ­¥é©Ÿ 5: æª¢æŸ¥ HTTP å›æ‡‰ç‹€æ…‹
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `ä¼ºæœå™¨éŒ¯èª¤: ${response.status}`);
                    }

                    // æ­¥é©Ÿ 6: è§£æ AI å›æ‡‰çµæœ
                    const result = await response.json();
                    const relevantKeywords = result.relevant_keywords;  // AI èªç‚ºç›¸é—œçš„é—œéµå­—é™£åˆ—
                    console.log('AI å›æ‡‰çµæœ:', relevantKeywords);

                    // æ­¥é©Ÿ 7: æ ¹æ“šçµæœæ›´æ–° UI
                    if (relevantKeywords && relevantKeywords.length > 0) {
                        // æœ‰æ‰¾åˆ°ç›¸é—œé …ç›®çš„æƒ…æ³
                        console.log(`æ‰¾åˆ° ${relevantKeywords.length} å€‹ç›¸é—œé …ç›®`);

                        // å»ºç«‹æˆåŠŸè¨Šæ¯çš„ HTML
                        let statusHTML = `ç‚ºæ‚¨æ‰¾åˆ° ${relevantKeywords.length} å€‹ç›¸é—œé …ç›®ï¼<br>`;

                        // å°‡æ¯å€‹ç›¸é—œé …ç›®åŒ…è£æˆå¯è¦–çš„æ¨™ç±¤
                        const itemsHTML = relevantKeywords.map(keyword =>
                            `<span class="found-item">${keyword}</span>`
                        ).join('ã€');  // ç”¨é “è™Ÿåˆ†éš”å¤šå€‹é …ç›®

                        // æ›´æ–°ç‹€æ…‹é¡¯ç¤ºå€åŸŸ
                        statusDiv.innerHTML = statusHTML + itemsHTML;

                        // é«˜äº®é¡¯ç¤ºç›¸é—œé …ç›®
                        highlightResults(relevantKeywords);
                    } else {
                        // æ²’æœ‰æ‰¾åˆ°ç›¸é—œé …ç›®çš„æƒ…æ³
                        console.log('æœªæ‰¾åˆ°ç›¸é—œé …ç›®');
                        statusDiv.textContent = 'æŠ±æ­‰ï¼Œæ‰¾ä¸åˆ°èˆ‡æ‚¨å•é¡Œç›¸é—œçš„è³‡è¨Šï¼Œè«‹å˜—è©¦æ›´æ›å•æ³•ã€‚';
                    }

                } catch (error) {
                    // æ­¥é©Ÿ 8: éŒ¯èª¤è™•ç†
                    console.error('æŸ¥è©¢éç¨‹ç™¼ç”ŸéŒ¯èª¤:', error);
                    statusDiv.textContent = `æŸ¥è©¢å¤±æ•—: ${error.message}`;

                } finally {
                    // æ­¥é©Ÿ 9: ç„¡è«–æˆåŠŸæˆ–å¤±æ•—éƒ½è¦æ¢å¾© UI ç‹€æ…‹
                    queryBtn.disabled = false;      // é‡æ–°å•Ÿç”¨æŸ¥è©¢æŒ‰éˆ•
                    micBtn.disabled = false;        // é‡æ–°å•Ÿç”¨éº¥å…‹é¢¨æŒ‰éˆ•
                    queryBtn.textContent = 'æŸ¥è©¢';   // æ¢å¾©æŒ‰éˆ•æ–‡å­—
                    console.log('æŸ¥è©¢æµç¨‹çµæŸ');
                }
            }

            /**
             * é«˜äº®é¡¯ç¤ºæŸ¥è©¢çµæœ
             * @param {Array} keywordsToHighlight - éœ€è¦é«˜äº®çš„é—œéµå­—é™£åˆ—
             * åŠŸèƒ½ï¼š
             * 1. ç‚ºåŒ¹é…çš„é …ç›®æ·»åŠ é«˜äº®æ¨£å¼
             * 2. è‡ªå‹•æ²å‹•åˆ°ç¬¬ä¸€å€‹åŒ¹é…é …ç›®
             */
            function highlightResults(keywordsToHighlight) {
                console.log('é–‹å§‹é«˜äº®é¡¯ç¤ºçµæœ:', keywordsToHighlight);

                // å°‡è¦é«˜äº®çš„é—œéµå­—è½‰æ›ç‚º Set ä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡
                const highlightSet = new Set(keywordsToHighlight);

                // éæ­·æ‰€æœ‰é é¢é …ç›®ï¼Œæª¢æŸ¥æ˜¯å¦éœ€è¦é«˜äº®
                linkData.forEach((pageItem, index) => {
                    if (highlightSet.has(pageItem.keyword)) {
                        // ç‚ºåŒ¹é…çš„é …ç›®æ·»åŠ é«˜äº® CSS é¡åˆ¥
                        pageItem.element.classList.add('ai-highlight');
                        console.log(`é«˜äº®é …ç›® ${index + 1}: ${pageItem.keyword}`);
                    }
                });

                // è‡ªå‹•æ²å‹•åˆ°ç¬¬ä¸€å€‹åŒ¹é…çš„é …ç›®ä»¥æå‡ä½¿ç”¨è€…é«”é©—
                if (keywordsToHighlight.length > 0) {
                    const firstMatchItem = linkData.find(pageItem =>
                        pageItem.keyword === keywordsToHighlight[0]
                    );

                    if (firstMatchItem) {
                        console.log('è‡ªå‹•æ²å‹•åˆ°ç¬¬ä¸€å€‹åŒ¹é…é …ç›®');
                        firstMatchItem.element.scrollIntoView({
                            behavior: 'smooth',  // å¹³æ»‘æ²å‹•æ•ˆæœ
                            block: 'center'      // å°‡é …ç›®ç½®æ–¼è¢å¹•ä¸­å¤®
                        });
                    }
                }
            }

            /**
             * æ¸…é™¤æ‰€æœ‰é«˜äº®æ•ˆæœ
             * åŠŸèƒ½ï¼šç§»é™¤é é¢ä¸­æ‰€æœ‰å…·æœ‰ .ai-highlight é¡åˆ¥çš„å…ƒç´ çš„é«˜äº®æ•ˆæœ
             * ä½¿ç”¨æ™‚æ©Ÿï¼šæ–°æŸ¥è©¢é–‹å§‹å‰ã€é‡ç½®é é¢ç‹€æ…‹æ™‚
             */
            function clearHighlights() {
                console.log('æ¸…é™¤æ‰€æœ‰é«˜äº®æ•ˆæœ');
                // æ‰¾åˆ°æ‰€æœ‰å…·æœ‰é«˜äº®é¡åˆ¥çš„å…ƒç´ ä¸¦ç§»é™¤è©²é¡åˆ¥
                document.querySelectorAll('.ai-highlight').forEach(item =>
                    item.classList.remove('ai-highlight')
                );
            }

            // --- èªéŸ³è­˜åˆ¥åŠŸèƒ½è¨­å®š ---

            /**
             * Web Speech API èªéŸ³è­˜åˆ¥åˆå§‹åŒ–
             * åŠŸèƒ½ï¼š
             * 1. æª¢æ¸¬ç€è¦½å™¨èªéŸ³è­˜åˆ¥æ”¯æ´æ€§
             * 2. è¨­å®šèªéŸ³è­˜åˆ¥åƒæ•¸
             * 3. è™•ç†èªéŸ³è­˜åˆ¥çš„ç”Ÿå‘½é€±æœŸäº‹ä»¶
             * 4. æä¾›å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œä½¿ç”¨è€…å›é¥‹
             */

            // å–å¾—ç€è¦½å™¨çš„èªéŸ³è­˜åˆ¥ APIï¼ˆæ”¯æ´ Chrome å’Œå…¶ä»– Webkit ç€è¦½å™¨ï¼‰
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (SpeechRecognition) {
                console.log('ç€è¦½å™¨æ”¯æ´èªéŸ³è­˜åˆ¥åŠŸèƒ½');

                // å»ºç«‹èªéŸ³è­˜åˆ¥å¯¦ä¾‹
                const recognition = new SpeechRecognition();

                // èªéŸ³è­˜åˆ¥åƒæ•¸è¨­å®š
                recognition.continuous = false;      // ä¸æŒçºŒç›£è½ï¼Œä¸€æ¬¡è­˜åˆ¥å¾Œè‡ªå‹•åœæ­¢
                recognition.lang = 'zh-TW';         // è¨­å®šè­˜åˆ¥èªè¨€ç‚ºç¹é«”ä¸­æ–‡
                recognition.interimResults = false; // ä¸éœ€è¦å³æ™‚çµæœï¼Œåªè¦æœ€çµ‚çµæœ

                console.log('èªéŸ³è­˜åˆ¥åƒæ•¸è¨­å®šå®Œæˆ: èªè¨€=zh-TW, æŒçºŒç›£è½=false');

                /**
                 * èªéŸ³è­˜åˆ¥é–‹å§‹äº‹ä»¶è™•ç†
                 * è§¸ç™¼æ™‚æ©Ÿï¼šä½¿ç”¨è€…é»æ“Šéº¥å…‹é¢¨æŒ‰éˆ•ï¼Œé–‹å§‹éŒ„éŸ³æ™‚
                 * åŠŸèƒ½ï¼šæ›´æ–° UI ç‹€æ…‹ï¼Œé¡¯ç¤ºéŒ„éŸ³ä¸­çš„è¦–è¦ºæ•ˆæœ
                 */
                recognition.onstart = () => {
                    console.log('èªéŸ³è­˜åˆ¥é–‹å§‹');
                    micBtn.classList.add('is-recording');     // æ·»åŠ éŒ„éŸ³ä¸­çš„ CSS å‹•ç•«æ•ˆæœ
                    micBtn.disabled = true;                   // åœç”¨æŒ‰éˆ•é˜²æ­¢é‡è¤‡é»æ“Š
                    questionInput.placeholder = "è«‹é–‹å§‹èªªè©±...";  // æ›´æ–°è¼¸å…¥æ¡†æç¤ºæ–‡å­—
                };

                /**
                 * èªéŸ³è­˜åˆ¥çµæœäº‹ä»¶è™•ç†
                 * è§¸ç™¼æ™‚æ©Ÿï¼šèªéŸ³è­˜åˆ¥å®Œæˆï¼Œç²å¾—æ–‡å­—è½‰æ›çµæœæ™‚
                 * @param {SpeechRecognitionEvent} event - åŒ…å«è­˜åˆ¥çµæœçš„äº‹ä»¶ç‰©ä»¶
                 * åŠŸèƒ½ï¼šå°‡è­˜åˆ¥åˆ°çš„æ–‡å­—å¡«å…¥è¼¸å…¥æ¡†
                 */
                recognition.onresult = (event) => {
                    // å–å¾—è­˜åˆ¥çµæœä¸­çš„ç¬¬ä¸€å€‹æœ€ä½³åŒ¹é…æ–‡å­—
                    const transcript = event.results[0][0].transcript;
                    console.log('èªéŸ³è­˜åˆ¥çµæœ:', transcript);

                    // å°‡è­˜åˆ¥çµæœå¡«å…¥è¼¸å…¥æ¡†
                    questionInput.value = transcript;

                    // å¯é¸ï¼šè‡ªå‹•åŸ·è¡ŒæŸ¥è©¢ï¼ˆå¦‚æœå¸Œæœ›èªéŸ³è¼¸å…¥å¾Œç«‹å³æŸ¥è©¢ï¼‰
                    // performQuery();
                };

                /**
                 * èªéŸ³è­˜åˆ¥çµæŸäº‹ä»¶è™•ç†
                 * è§¸ç™¼æ™‚æ©Ÿï¼šèªéŸ³è­˜åˆ¥åœæ­¢æ™‚ï¼ˆç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼‰
                 * åŠŸèƒ½ï¼šæ¢å¾© UI ç‹€æ…‹ï¼Œç§»é™¤éŒ„éŸ³è¦–è¦ºæ•ˆæœ
                 */
                recognition.onend = () => {
                    console.log('èªéŸ³è­˜åˆ¥çµæŸ');
                    micBtn.classList.remove('is-recording');  // ç§»é™¤éŒ„éŸ³ä¸­çš„å‹•ç•«æ•ˆæœ
                    micBtn.disabled = false;                  // é‡æ–°å•Ÿç”¨éº¥å…‹é¢¨æŒ‰éˆ•
                    questionInput.placeholder = "ä¾‹å¦‚ï¼šå®¿èˆå¦‚ä½•ç”³è«‹ï¼Ÿæˆ–é»æ“Šéº¥å…‹é¢¨èªªè©±";  // æ¢å¾©åŸå§‹æç¤ºæ–‡å­—
                };

                /**
                 * èªéŸ³è­˜åˆ¥éŒ¯èª¤äº‹ä»¶è™•ç†
                 * è§¸ç™¼æ™‚æ©Ÿï¼šèªéŸ³è­˜åˆ¥éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤æ™‚
                 * @param {SpeechRecognitionError} event - åŒ…å«éŒ¯èª¤ä¿¡æ¯çš„äº‹ä»¶ç‰©ä»¶
                 * åŠŸèƒ½ï¼šæ ¹æ“šä¸åŒéŒ¯èª¤é¡å‹æä¾›ç›¸æ‡‰çš„ä½¿ç”¨è€…æç¤º
                 */
                recognition.onerror = (event) => {
                    console.error('èªéŸ³è­˜åˆ¥ç™¼ç”ŸéŒ¯èª¤:', event.error);

                    // æ¢å¾© UI ç‹€æ…‹
                    micBtn.classList.remove('is-recording');
                    micBtn.disabled = false;

                    // æ ¹æ“šéŒ¯èª¤é¡å‹æä¾›å…·é«”çš„ä½¿ç”¨è€…æç¤º
                    if (event.error === 'not-allowed') {
                        // ä½¿ç”¨è€…æ‹’çµ•éº¥å…‹é¢¨æ¬Šé™
                        alert('æ‚¨æ‹’çµ•äº†éº¥å…‹é¢¨æ¬Šé™ã€‚å¦‚éœ€ä½¿ç”¨èªéŸ³è¼¸å…¥ï¼Œè«‹åœ¨ç€è¦½å™¨è¨­å®šä¸­å…è¨±æœ¬ç¶²ç«™ä½¿ç”¨éº¥å…‹é¢¨ã€‚');
                    } else if (event.error === 'no-speech') {
                        // æ²’æœ‰æª¢æ¸¬åˆ°èªéŸ³è¼¸å…¥
                        alert('æ²’æœ‰æª¢æ¸¬åˆ°èªéŸ³ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚');
                    } else if (event.error === 'audio-capture') {
                        // éŸ³è¨Šè¨­å‚™å•é¡Œ
                        alert('ç„¡æ³•å­˜å–éº¥å…‹é¢¨ï¼Œè«‹æª¢æŸ¥æ‚¨çš„éŸ³è¨Šè¨­å‚™ã€‚');
                    } else if (event.error === 'network') {
                        // ç¶²è·¯é€£ç·šå•é¡Œ
                        alert('ç¶²è·¯é€£ç·šå•é¡Œï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šã€‚');
                    } else {
                        // å…¶ä»–æœªçŸ¥éŒ¯èª¤
                        alert(`ç™¼ç”ŸèªéŸ³è¾¨è­˜éŒ¯èª¤: ${event.error}`);
                    }
                };

                /**
                 * éº¥å…‹é¢¨æŒ‰éˆ•é»æ“Šäº‹ä»¶è™•ç†
                 * åŠŸèƒ½ï¼šå•Ÿå‹•èªéŸ³è­˜åˆ¥ï¼Œä¸¦è™•ç†å¯èƒ½çš„å•Ÿå‹•éŒ¯èª¤
                 */
                micBtn.addEventListener('click', () => {
                    // é˜²æ­¢åœ¨éŒ„éŸ³éç¨‹ä¸­é‡è¤‡é»æ“Š
                    if (micBtn.disabled) {
                        console.log('éº¥å…‹é¢¨æŒ‰éˆ•å·²åœç”¨ï¼Œå¿½ç•¥é»æ“Š');
                        return;
                    }

                    console.log('ä½¿ç”¨è€…é»æ“Šéº¥å…‹é¢¨æŒ‰éˆ•');

                    try {
                        // å˜—è©¦å•Ÿå‹•èªéŸ³è­˜åˆ¥
                        recognition.start();
                    } catch (e) {
                        // è™•ç†å•Ÿå‹•å¤±æ•—çš„æƒ…æ³ï¼ˆé€šå¸¸æ˜¯å› ç‚ºç€è¦½å™¨æ­£åœ¨è™•ç†å…¶ä»–éŸ³è¨Šï¼‰
                        console.error('ç„¡æ³•å•Ÿå‹•èªéŸ³è­˜åˆ¥:', e);
                        alert("ç„¡æ³•å•Ÿå‹•èªéŸ³è¾¨è­˜ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½æ­£åœ¨è™•ç†å…¶ä»–éŸ³è¨Šã€‚");
                    }
                });

            } else {
                // ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è­˜åˆ¥åŠŸèƒ½
                console.warn('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è­˜åˆ¥åŠŸèƒ½');
                micBtn.style.display = 'none';  // éš±è—éº¥å…‹é¢¨æŒ‰éˆ•
            }

            // --- ç¨‹å¼åˆå§‹åŒ–å’Œäº‹ä»¶ç¶å®š ---

            console.log('é–‹å§‹ç¨‹å¼åˆå§‹åŒ–...');

            // åˆå§‹åŒ–ï¼šæ”¶é›†é é¢è³‡æ–™
            updateLinkData();

            // äº‹ä»¶ç¶å®š 1: æŸ¥è©¢æŒ‰éˆ•é»æ“Šäº‹ä»¶
            queryBtn.addEventListener('click', () => {
                console.log('ä½¿ç”¨è€…é»æ“ŠæŸ¥è©¢æŒ‰éˆ•');
                performQuery();
            });

            // äº‹ä»¶ç¶å®š 2: è¼¸å…¥æ¡† Enter éµäº‹ä»¶ï¼ˆæå‡ä½¿ç”¨è€…é«”é©—ï¼‰
            questionInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    console.log('ä½¿ç”¨è€…æŒ‰ä¸‹ Enter éµ');
                    performQuery();
                }
            });

            console.log('AI èªéŸ³æŸ¥è©¢ç³»çµ±åˆå§‹åŒ–å®Œæˆï¼');
        });
</script>
</body>
</html>